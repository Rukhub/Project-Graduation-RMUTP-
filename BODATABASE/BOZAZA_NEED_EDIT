app.post('/api/reports', upload.single('image'), (req, res) => {
    const { asset_id, reporter_name, fullname, issue_detail, details, image_url } = req.body;

    const reporter = reporter_name || fullname || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠';
    const detail = issue_detail || details || '';

    // ‚≠ê ‡∏£‡∏±‡∏ö image_url ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å Flutter ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡πà‡∏≤‡∏ô multipart
    let imageUrl = image_url || '';  // üëà ‡πÉ‡∏ä‡πâ URL ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô
    
    if (!imageUrl && req.file) {  // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ URL ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà
        imageUrl = `${req.protocol}://${req.get('host')}/uploads/${req.file.filename}`;
    }

    db.query(
        `INSERT INTO reports (asset_id, reporter_name, issue_detail, image_url, report_date)
         VALUES (?, ?, ?, ?, NOW())`,
        [asset_id, reporter, detail, imageUrl],
        (err) => {
            if (err) {
                console.error('‚ùå Database Error:', err);
                return res.status(500).json({ success: false, message: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' });
            }
            res.json({ success: true });
        }
    );
});
