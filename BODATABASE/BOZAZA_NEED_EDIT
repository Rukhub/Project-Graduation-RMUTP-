// ==========================================
// üîß PATCH FOR BACKEND: Fix Report Problem Image Display
// ==========================================
// ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Detail
// ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: Backend ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å report_images ‡πÉ‡∏ô reports table ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô assets table
// ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï /api/reports endpoint ‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° report_images ‡∏•‡∏á‡πÉ‡∏ô assets table
// --- ‡πÄ‡∏î‡∏¥‡∏° (‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå index.js ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î ~270-283) ---
/*
app.post('/api/reports', (req, res) => {
    const { asset_id, reporter_name, issue_detail, image_url } = req.body; 
    const sqlReport = "INSERT INTO reports (asset_id, reporter_name, issue_detail, image_url) VALUES (?, ?, ?, ?)";
    const sqlUpdateAsset = "UPDATE assets SET status = '‡∏ä‡∏≥‡∏£‡∏∏‡∏î', reporter_name = ?, issue_detail = ?, report_date = NOW() WHERE asset_id = ?";
    db.query(sqlReport, [asset_id, reporter_name, issue_detail, image_url], (err) => {
        if (err) return res.status(500).json({ message: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", error: err });
        db.query(sqlUpdateAsset, [reporter_name, issue_detail, asset_id], (err2) => {
            if (err2) return res.status(500).json({ message: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" });
            res.json({ success: true, message: "‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!" });
        });
    });
});
*/
// --- ‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô) ---
app.post('/api/reports', (req, res) => {
    const { asset_id, reporter_name, issue_detail, image_url } = req.body;
    const sqlReport = "INSERT INTO reports (asset_id, reporter_name, issue_detail, image_url) VALUES (?, ?, ?, ?)";
    // ‚≠ê ‡πÄ‡∏û‡∏¥‡πà‡∏° report_images ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô assets table
    const sqlUpdateAsset = `
        UPDATE assets 
        SET status = '‡∏ä‡∏≥‡∏£‡∏∏‡∏î', 
            reporter_name = ?, 
            issue_detail = ?, 
            report_images = ?,
            report_date = NOW() 
        WHERE asset_id = ?
    `;
    db.query(sqlReport, [asset_id, reporter_name, issue_detail, image_url], (err) => {
        if (err) return res.status(500).json({ message: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", error: err });
        // ‚≠ê ‡∏™‡πà‡∏á image_url ‡πÑ‡∏õ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô assets.report_images ‡∏î‡πâ‡∏ß‡∏¢
        db.query(sqlUpdateAsset, [reporter_name, issue_detail, image_url, asset_id], (err2) => {
            if (err2) {
                console.error("‚ùå Update Asset Error:", err2);
                return res.status(500).json({ message: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", error: err2 });
            }
            res.json({ success: true, message: "‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!" });
        });
    });
});
// ==========================================
// üìã DATABASE MIGRATION REQUIRED
// ==========================================
// ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ô SQL ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô MySQL ‡∏Å‡πà‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ:
/*
ALTER TABLE assets
ADD COLUMN report_images TEXT AFTER image_url;
*/
// ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ô ALTER TABLE ‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
